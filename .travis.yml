language: node_js
node_js:
  - "10"

services:
  - mysql

# 設定參數(Travis CI 會按照參數分別執行)
env:
  - NODE_ENV=test

# 在 install 前執行的指令
before_install:
  - mysql -e 'CREATE DATABASE IF NOT EXISTS masungo default character set utf8mb4 collate utf8mb4_unicode_ci;'
  - npm install sequelize-cli -g
  - npm install mocha -g
  - export JWT_SECRET=masugogogo

# 在執行測試之前的指令
before_script:
  - sequelize db:migrate

deploy:
  provider: heroku
  edge: true
  api_key:
    secure: b708d5dd-0ff1-4c68-a8ef-258740ca6bf0
  app: masungo-backend
  on:
    repo: surferintaiwan/masungo-backend
